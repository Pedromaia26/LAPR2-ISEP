<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Test.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Sem2App</a> &gt; <a href="index.source.html" class="el_package">app.domain.model</a> &gt; <span class="el_source">Test.java</span></div><h1>Test.java</h1><pre class="source lang-java linenums">package app.domain.model;

import net.sourceforge.barbecue.BarcodeException;
import net.sourceforge.barbecue.output.OutputException;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Objects;

public class Test {


    private List&lt;TestParameterResult&gt; results;
    /**
     * String that contains the code of a test.
     */
    private String code;
    /**
     * The National Healthcare Service.
     */
    private long nhsCode;
    /**
     * The lab order prescribed by a doctor that contains the type of tests and parameter of a test being analysed.
     */
    private LabOrder labOrder;
    /**
     * The external module that provides reference values to be compared to the results of a parameter.
     */
    private ExternalModule em;
    /**
     * A list containing the parameters of a test.
     */
    private List&lt;TestParameter&gt; testParameterList;
    /**
     * An object of type Date used to obtain the date when a result of a test was recorded.
     */
    private Date resultRegist;
    /**
     * The report associated to each test.
     */
    private Report report;
    /**
     * List containing the samples.
     */
<span class="nc" id="L47">    private List&lt;Sample&gt; sample = new ArrayList&lt;&gt;();</span>

    /**
     * Empty constructor that initializes a list of parameters test.
     */
<span class="nc" id="L52">    public Test (){</span>
<span class="nc" id="L53">        testParameterList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L54">        results = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L55">    }</span>

    /**
     * Creates an instance of Test, receiving by parameter its code, its National Healthcare Service code
     * and the lab order associated to the test.
     * @param code code of the test.
     * @param nhsCode National Healthcare Service code of the test.
     * @param labOrder lab order prescribed by the doctor for a given test.
     */
<span class="nc" id="L64">    public Test(String code, long nhsCode, LabOrder labOrder){</span>

<span class="nc bnc" id="L66" title="All 2 branches missed.">        if (code.trim().length() != 10)</span>
<span class="nc" id="L67">            throw new IllegalArgumentException(&quot;Code should have 10 digits&quot;);</span>
<span class="nc" id="L68">        this.code = code;</span>

<span class="nc bnc" id="L70" title="All 2 branches missed.">        if (String.valueOf(nhsCode).length() != 10)</span>
<span class="nc" id="L71">            throw new IllegalArgumentException(&quot;National Health Service Code should have 10 digits&quot;);</span>

<span class="nc" id="L73">        this.nhsCode = nhsCode;</span>

<span class="nc" id="L75">        this.labOrder = labOrder;</span>
<span class="nc" id="L76">        em = new ExternalModule() {</span>
            @Override
            public ReferenceValue getReferenceValue(Parameter parameter) {
<span class="nc" id="L79">                return null;</span>
            }

            @Override
            public String getMetric(Parameter parameter) {
<span class="nc" id="L84">                return null;</span>
            }
        };

<span class="nc" id="L88">        testParameterList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L89">        testParameterList = addToList(labOrder.getParameters());</span>

<span class="nc" id="L91">    }</span>

    /**
     * Returns the code of a test.
     * @return the code of a test .
     */

    public String getCode() {
<span class="nc" id="L99">        return code;</span>
    }

    /**
     * Returns the National Health Service code of a test.
     * @return the National Health Service code of a test.
     */

    public long getNhsCode() {
<span class="nc" id="L108">        return nhsCode;</span>
    }


    /**
     * Returns the lab order of a test.
     * @return the lab order.
     */

    public LabOrder getLabOrder() {
<span class="nc" id="L118">        return labOrder;</span>
    }

    /**
     * Returns the list of existing samples.
     * @return list of samples.
     */

    public List&lt;Sample&gt; getSample() {
<span class="nc" id="L127">        return sample;</span>
    }

    /**
     * Returns the list of parameters of a test.
     * @return list of parameters of a test.
     */

<span class="nc" id="L135">    public List&lt;TestParameter&gt; getTestParameter(){ return testParameterList; }</span>

    /**
     * Returns the report of a test
     * @return the report of a test
     */

    public Report getReport(){
<span class="nc" id="L143">        return report;</span>
    }

    /**
     * Returns the test parameter from a test.
     * @param parameterCode receives a parameter code by parameter and proceeds to check if this code exists.
     * @return the test parameter intended if the code exists. If not, informs the user that the code does not exist.
     */
    public TestParameter getTestParameterFor(String parameterCode){
<span class="nc bnc" id="L152" title="All 2 branches missed.">        for (TestParameter testParam: testParameterList) {</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">            if (parameterCode.equals(testParam.getParameter().getCode()))</span>
<span class="nc" id="L154">                return testParam;</span>
<span class="nc" id="L155">        }</span>
<span class="nc" id="L156">        throw new IllegalArgumentException (&quot;There is no parameter with such code&quot;);</span>
    }



    /**
     * Compares an object of test that evokes the method with another.
     * @param o The object to compare.
     * @return True if both objects are equal and false if not.
     */
    @Override
    public boolean equals(Object o) {
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (this == o)</span>
<span class="nc" id="L169">            return true;</span>
<span class="nc bnc" id="L170" title="All 4 branches missed.">        if (o == null || getClass() != o.getClass()) return false;</span>
<span class="nc" id="L171">        Test test = (Test) o;</span>
<span class="nc bnc" id="L172" title="All 6 branches missed.">        return Objects.equals(code, test.code) &amp;&amp; Objects.equals(nhsCode, test.nhsCode) &amp;&amp; Objects.equals(labOrder, test.labOrder);</span>
    }

    /**
     * Returns the textual description of a test.
     * @return characteristics of a test.
     */
    public String toString() {
<span class="nc" id="L180">        return &quot;Test:&quot; + labOrder + &quot;, sample=&quot; + sample;</span>
    }

    /**
     * Validates the sample received.
     * @param samp the sample to be validated.
     * @return True if the sample is successfully validated, false if it is not.
     */
    public boolean validateSample(Sample samp, Company company){
<span class="nc bnc" id="L189" title="All 2 branches missed.">        if (samp == null)</span>
<span class="nc" id="L190">            return false;</span>

<span class="nc" id="L192">        List&lt;Test&gt; tests= company.getTestStore().getTests();</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">        for(Test testss : tests){</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">            for (Sample samples : testss.getSample()) {</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">                if (samples.getBarcode().equals(samp.getBarcode())) {</span>
<span class="nc" id="L196">                    return false;</span>

                }
<span class="nc" id="L199">            }</span>
<span class="nc" id="L200">        }</span>
<span class="nc" id="L201">        return true;</span>
    }
    /**
     * Saves the sample received in the test.
     * @param samp the sample to be saved.
     * @return True if the sample is successfully saved, false if it is not.
     */
    public boolean saveSample(Sample samp, Company company) throws BarcodeException, OutputException {
<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (!validateSample(samp,company))</span>
<span class="nc" id="L210">            return false;</span>

<span class="nc" id="L212">        samp.imageIoWrite(samp.makeUPCABarcode(samp.getBarcode()), samp.getBarcode());</span>
<span class="nc" id="L213">        return addSample(samp);</span>
    }

    /**
     * Adds a sample to the list of samples.
     * @param samp the sample to be added.
     * @return
     */
    public boolean addSample(Sample samp){

<span class="nc" id="L223">        return this.sample.add(samp);</span>

    }

    /**
     * Creates a report of the test.
     * @param report the report of the test.
     */
    public void addReport(Report report){
<span class="nc" id="L232">        this.report = report;</span>
<span class="nc" id="L233">    }</span>

    /**
     * Create a new sample with the dto received.
     * @return The Sample created.
     */
    public Sample RecordNewSample(Company c) {
<span class="nc" id="L240">        return new Sample(c);</span>
    }

    /**
     * Returns the external module being used to obtain the reference values.
     * @return the external module.
     */
    public ExternalModule getExternalModule (){
<span class="nc" id="L248">        return em;</span>
    }

    /**
     * Adds a result to a parameter of a test, comparing the value received by parameter
     * and the existing reference values provided by the external module.
     * @param parameterCode the code of the parameter for which we pretend to add a result.
     * @param result the value obtained from a test parameter of a given client.
     */
    public void addTestResult (String parameterCode, Double result){
<span class="nc" id="L258">        checkResultRules(result);</span>
<span class="nc" id="L259">        TestParameter tp = getTestParameterFor(parameterCode);</span>
<span class="nc" id="L260">        ReferenceValue refValue = em.getReferenceValue(tp.getParameter());</span>
<span class="nc" id="L261">        String metric = em.getMetric(tp.getParameter());</span>
<span class="nc" id="L262">        tp.addResult(result, metric, refValue);</span>
<span class="nc" id="L263">        resultRegist = new Date();</span>
<span class="nc" id="L264">    }</span>


    public List&lt;TestParameter&gt; addToList (List &lt;Parameter&gt; p){
<span class="nc bnc" id="L268" title="All 2 branches missed.">        for (Parameter par: p){</span>
<span class="nc" id="L269">            testParameterList.add(new TestParameter(par));</span>
<span class="nc" id="L270">        }</span>
<span class="nc" id="L271">        return testParameterList;</span>
    }

    /**
     * Checks the parameter result restrictions
     * @param result the result of a given parameter of a test.
     */
    public void checkResultRules (Double result){
<span class="nc bnc" id="L279" title="All 2 branches missed.">        if (result&lt;0)</span>
<span class="nc" id="L280">            throw new IllegalArgumentException(&quot;The result cannot be negative!&quot;);</span>
<span class="nc" id="L281">    }</span>


}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>